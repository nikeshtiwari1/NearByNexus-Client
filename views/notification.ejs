<%- include('partials/navbar.ejs') %> <br /><br />
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" ></script>
<script src="./js/notification.js"></script>

<div class="container">
        <div class="col-lg-12 right">
            <!-- <div class="box shadow-sm rounded bg-white mb-3">
                <div class="box-title border-bottom p-3">
                    <h6 class="m-0">Recent</h6>
                </div>
                <div class="box-body p-0">
                    <div class="p-3 d-flex align-items-center bg-light border-bottom osahan-post-header">
                        <div class="dropdown-list-image mr-3">
                            <img class="rounded-circle" src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="" />
                        </div>
                        <div class="font-weight-bold mr-3">
                            <div class="text-truncate">DAILY RUNDOWN: WEDNESDAY</div>
                            <div class="small">Income tax sops on the cards, The bias in VC funding, and other top news for you</div>
                        </div>
                        <span class="ml-auto mb-auto">
                            <div class="btn-group">
                                <button type="button" class="btn btn-light btn-sm rounded" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="mdi mdi-dots-vertical"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <button class="dropdown-item" type="button"><i class="mdi mdi-delete"></i> Delete</button>
                                    <button class="dropdown-item" type="button"><i class="mdi mdi-close"></i> Turn Off</button>
                                </div>
                            </div>
                            <br />
                            <div class="text-right text-muted pt-1">3d</div>
                        </span>
                    </div>
                    <div class="p-3 d-flex align-items-center osahan-post-header">
                        <div class="dropdown-list-image mr-3">
                            <img class="rounded-circle" src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" />
                        </div>
                        <div class="font-weight-bold mr-3">
                            <div class="mb-2">We found a job at askbootstrap Ltd that you may be interested in Vivamus imperdiet venenatis est...</div>
                            <button type="button" class="btn btn-outline-success btn-sm">View Jobs</button>
                        </div>
                        <span class="ml-auto mb-auto">
                            <div class="btn-group">
                                <button type="button" class="btn btn-light btn-sm rounded" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="mdi mdi-dots-vertical"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <button class="dropdown-item" type="button"><i class="mdi mdi-delete"></i> Delete</button>
                                    <button class="dropdown-item" type="button"><i class="mdi mdi-close"></i> Turn Off</button>
                                </div>
                            </div>
                            <br />
                            <div class="text-right text-muted pt-1">4d</div>
                        </span>
                    </div>
                </div>
            </div> -->
            <div class="box shadow-sm rounded bg-white mb-3">
                <div class="box-title border-bottom p-3">
                    <h6 class="m-0">Notifications</h6>
                </div>
                
                <div class="box-body p-0">

                  <% if (data.notifications.notifications && data.notifications.notifications.length > 0) { %>
                  <% data.notifications.notifications.forEach(function(notification) { %>
                    <div class="p-2 d-flex align-items-center border-bottom osahan-post-header" >
                        <div class="dropdown-list-image mr-3 p-3 d-flex align-items-center bg-danger justify-content-center rounded-circle text-white"> <% if (notification.sender) { %>
                          <%= getInitials(notification.sender.name) %>
                        <% } else { %>
                          UT
                        <% } %></div>
                        <div class="font-weight-bold mr-6 ms-2 col-lg-11 pointer" <% if (notification.post) { %> onclick="handleNotificationClick('<%= notification.post._id %>')" <% } %>>
                            <div class="text-truncate"><% if (notification.sender) { %><%= notification.sender.name %>: <%= notification.sender.address %><%}%></div>
                            <div class="small"> <%= notification.message.length > 100 ? notification.message.slice(0, 100) + '...' : notification.message %></div>
                        </div>
                       
                        <div class="ml-2 mb-auto float-right col-lg-1">
                            <div class="btn-group dropdown show">
                              <a class="btn btn-light btn-sm rounded dropdown-toggle" data-toggle="dropdown" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="bi bi-three-dots-vertical"></i>
                              </a>
                              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <button class="dropdown-item" type="button"><i class="bi bi-trash"></i> Delete</button>
                                <button class="dropdown-item" type="button"><i class="bi bi-power"></i>                                    Turn Off</button>
                              </div>
                            </div>
                            <br />
                            <div class="text-right text-muted pt-1"><%= getElapsedTime(notification.createdAt) %></div>
                          </div>
                         
                    </div>
                    <% }) %>
                    <% } else { %>
                      <div class="small">
                        No notifications found.
                      </div>
                      <% } %>
                    <!-- <div class="p-3 d-flex align-items-center border-bottom osahan-post-header">
                        <div class="dropdown-list-image mr-3">
                            <img class="rounded-circle" src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="" />
                        </div>
                        <div class="font-weight-bold mr-3">
                            <div class="mb-2"><span class="font-weight-normal">Congratulate Gurdeep Singh Osahan (iamgurdeeposahan)</span> for 5 years at Askbootsrap Pvt.</div>
                            <button type="button" class="btn btn-outline-success btn-sm">Say congrats</button>
                        </div>
                        <span class="ml-auto mb-auto">
                            <div class="btn-group">
                                <button type="button" class="btn btn-light btn-sm rounded" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="mdi mdi-dots-vertical"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <button class="dropdown-item" type="button"><i class="mdi mdi-delete"></i> Delete</button>
                                    <button class="dropdown-item" type="button"><i class="mdi mdi-close"></i> Turn Off</button>
                                </div>
                            </div>
                            <br />
                            <div class="text-right text-muted pt-1">4d</div>
                        </span>
                    </div> -->
                    
                    
                    
                    

                </div>
            </div>
        </div>

</div>
<%
function getElapsedTime(createdAt) {
    const now = new Date();
    const createdDate = new Date(createdAt);
    const timeDiff = now - createdDate;
  
    const secondsDiff = Math.floor(timeDiff / 1000);
    if (secondsDiff < 60) {
      return `${secondsDiff}s`;
    }
  
    const minutesDiff = Math.floor(timeDiff / (1000 * 60));
    if (minutesDiff < 60) {
      return `${minutesDiff}m`;
    }
  
    const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
    if (hoursDiff < 24) {
      return `${hoursDiff}h`;
    }
  
    const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
    return `${daysDiff}d`;
  }
  

function getInitials(name) {
  const words = name.split(' ');
  const initials = words.map(word => word.charAt(0).toUpperCase()).join('');
  return initials;
}
%>
<script>
  $(document).ready(function() {
    $('.dropdown-toggle').dropdown();
  });
</script>

<%- include('partials/footer.ejs') %>
